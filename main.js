(()=>{"use strict";function t(t){t.classList.add("popup_opened"),window.onkeydown=function(n){27==n.keyCode&&e(t)}}function e(t){t.classList.remove("popup_opened"),window.onkeydown=null}var n={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"3a76beda-dcbb-4c59-817c-2a3fb7dba694","Content-Type":"application/json"}};function o(t,e){return fetch("".concat(n.baseUrl,"/").concat(t),{method:e,headers:n.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function r(t,e,o){return fetch("".concat(n.baseUrl,"/").concat(t),{method:e,headers:n.headers,body:JSON.stringify(o)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}var c=document.getElementById("card-template"),a=document.querySelector(".popup-image"),u=a.querySelector(".popup-image__img"),i=a.querySelector(".popup-image__img-description");function l(t){var e,n=t.target.closest(".cards__item");(e=n.dataset.cardId,o("cards/".concat(e),"DELETE")).then((function(t){n.remove()})).catch((function(t){console.log(t)}))}function s(e,n,o,r,s){var f=c.content.cloneNode(!0),m=f.querySelector(".cards__image");m.src=n,m.alt=e,f.querySelector(".cards__location").textContent=e;var _=f.querySelector(".cards__icon");s&&_.classList.add("cards__icon_active"),_.addEventListener("click",d);var v=f.querySelector(".cards__trash-button");return r?v.addEventListener("click",l):v.remove(),m.addEventListener("click",(function(){return function(e,n){u.src=n,u.alt=e,i.textContent=e,t(a)}(e,n)})),f.querySelector(".cards__like-counter").textContent=o.toString(),f}function d(t){var e,n,r,c=t.target.closest(".cards__item"),a=c.querySelector(".cards__like-counter");(e=c.dataset.cardId,n=!t.target.classList.contains("cards__icon_active"),r=n?"PUT":"DELETE",o("cards/likes/".concat(e),r)).then((function(e){a.textContent=e.likes.length.toString(),t.target.classList.toggle("cards__icon_active")})).catch((function(t){console.log(t)}))}function f(t,e){t.validity.valid?e.textContent="":t.validity.patternMismatch?e.textContent=t.dataset.patternError:e.textContent=t.validationMessage}function m(t,e,n){var o=t.inactiveButtonClass;!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?n.classList.remove(o):n.classList.add(o)}function _(t,e){return t.querySelector(".".concat(e.id,"-error"))}function v(t,e){m(t,Array.from(e.querySelectorAll(t.inputSelector)),e.querySelector(t.submitButtonSelector))}var p,y=document.querySelectorAll(".popup"),S=document.querySelector(".popup-profile"),q=document.querySelector(".profile__edit-button"),h=S.querySelector(".form"),b=document.querySelector(".profile__image"),g=S.querySelector(".form__button"),E=g.textContent,C=document.querySelector(".popup-avatar"),k=document.querySelector(".profile__image-edit"),L=document.querySelector(".form__input_avatar-url"),x=C.querySelector(".form"),A=C.querySelector(".form__button"),T=A.textContent,B=document.querySelector(".cards"),w=document.querySelector(".popup-add"),D=document.querySelector(".profile__add-button"),P=w.querySelector(".form"),j=document.querySelector(".form__input_title"),I=document.querySelector(".form__input_link"),U=w.querySelector(".form__button"),G=U.textContent,H=document.querySelector(".profile__name"),M=document.querySelector(".profile__subtitle"),N=document.querySelector(".form__input_name"),O=document.querySelector(".form__input_subtitle"),z={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button-inactive"};function J(t,e,n){t.insertBefore(e,t.firstChild),t.firstElementChild.dataset.cardId=n}function F(t){t.textContent="Сохранение..."}function K(t,e,n){H.textContent=t,M.textContent=e,b.src=n,b.alt=t}o("users/me","GET").then((function(t){K(t.name,t.about,t.avatar),o("cards","GET").then((function(e){var n,o;n=e.reverse(),o=t._id,n.forEach((function(t){var e=t.likes.some((function(t){return t._id===o})),n=s(t.name,t.link,t.likes.length,t.owner._id===o,e);J(B,n,t._id)}))})).catch((function(t){console.log(t)}))})).catch((function(t){console.log(t)})),p=z,Array.from(document.querySelectorAll(p.formSelector)).forEach((function(t){!function(t,e){e.addEventListener("submit",(function(t){t.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){var c=_(e,r);r.addEventListener("input",(function(){f(r,c),m(t,n,o)}))}))}(p,t)})),y.forEach((function(t){t.querySelector(".overlay").addEventListener("click",(function(){e(t)})),t.querySelector(".popup__button-close").addEventListener("click",(function(){e(t)}))})),q.addEventListener("click",(function(){var e,n,o;g.textContent=E,N.value=H.textContent,O.value=M.textContent,n=S,m(e=z,o=Array.from(n.querySelectorAll(e.inputSelector)),n.querySelector(e.submitButtonSelector)),o.forEach((function(t){f(t,_(n,t))})),t(S)})),h.addEventListener("submit",(function(t){var n,o;t.preventDefault(),(n=N.value,o=O.value,r("users/me","PATCH",{name:n,about:o})).then((function(t){K(t.name,t.about,t.avatar)})).catch((function(t){console.log(t)})).finally((function(){e(S)})),F(g)})),D.addEventListener("click",(function(){return U.textContent=G,j.value="",I.value="",v(z,w),void t(w)})),P.addEventListener("submit",(function(t){var n,o;t.preventDefault(),(n=j.value,o=I.value,r("cards","POST",{name:n,link:o})).then((function(t){var e=s(t.name,t.link,t.likes.length,!0,!1);J(B,e,t._id)})).catch((function(t){console.log(t)})).finally((function(){e(w)})),F(U)})),k.addEventListener("click",(function(){return A.textContent=T,L.value="",v(z,C),void t(C)})),x.addEventListener("submit",(function(t){var n;t.preventDefault(),(n=L.value,r("users/me/avatar","PATCH",{avatar:n})).then((function(t){K(t.name,t.about,t.avatar)})).catch((function(t){console.log(t)})).finally((function(){e(C)})),F(A)}))})();